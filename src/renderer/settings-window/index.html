<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
  <title>Rift Architect â€” Settings</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      padding: 24px;
    }

    h1 {
      font-size: 18px;
      font-weight: 600;
      color: #e6edf3;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 12px;
      color: #8b949e;
      margin-bottom: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #c9d1d9;
      margin-bottom: 6px;
    }

    label .hint {
      font-weight: 400;
      color: #8b949e;
      font-size: 11px;
    }

    input[type="text"],
    input[type="password"],
    select {
      width: 100%;
      padding: 8px 12px;
      font-size: 13px;
      font-family: 'Consolas', 'Courier New', monospace;
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #c9d1d9;
      outline: none;
      transition: border-color 0.15s;
    }

    input:focus, select:focus {
      border-color: #58a6ff;
    }

    .row {
      display: flex;
      gap: 12px;
    }

    .row .form-group {
      flex: 1;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 24px;
    }

    button {
      padding: 8px 20px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .btn-primary {
      background: #238636;
      color: #fff;
    }

    .btn-primary:hover { background: #2ea043; }

    .btn-secondary {
      background: #21262d;
      color: #c9d1d9;
      border: 1px solid #30363d;
    }

    .btn-secondary:hover { background: #30363d; }

    .status {
      margin-top: 16px;
      padding: 10px 14px;
      border-radius: 6px;
      font-size: 12px;
      display: none;
    }

    .status.success {
      display: block;
      background: rgba(35, 134, 54, 0.15);
      border: 1px solid #238636;
      color: #3fb950;
    }

    .status.error {
      display: block;
      background: rgba(248, 81, 73, 0.15);
      border: 1px solid #f85149;
      color: #f85149;
    }

    .divider {
      height: 1px;
      background: #21262d;
      margin: 20px 0;
    }

    .toggle-vis {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      color: #8b949e;
      cursor: pointer;
      background: none;
      border: none;
      padding: 4px;
    }

    .toggle-vis:hover { color: #c9d1d9; }

    .input-wrapper {
      position: relative;
    }

    .legal {
      margin-top: 8px;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid #21262d;
      border-radius: 6px;
    }

    .legal-title {
      font-size: 11px;
      font-weight: 600;
      color: #8b949e;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .legal p {
      font-size: 10px;
      color: #6e7681;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <h1>Rift Architect Settings</h1>
  <div class="subtitle">API keys are stored securely in your AppData folder.</div>

  <form id="settingsForm">
    <div class="form-group">
      <label>Riot API Key <span class="hint">(developer.riotgames.com)</span></label>
      <div class="input-wrapper">
        <input type="password" id="riotKey" placeholder="RGAPI-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" autocomplete="off">
        <button type="button" class="toggle-vis" onclick="toggleVis('riotKey')">show</button>
      </div>
    </div>

    <div class="form-group">
      <label>Anthropic API Key <span class="hint">(console.anthropic.com)</span></label>
      <div class="input-wrapper">
        <input type="password" id="anthropicKey" placeholder="sk-ant-api03-xxxxxxxxxxxxx" autocomplete="off">
        <button type="button" class="toggle-vis" onclick="toggleVis('anthropicKey')">show</button>
      </div>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div class="form-group">
        <label>Riot Region</label>
        <select id="riotRegion">
          <option value="na1">NA (na1)</option>
          <option value="euw1">EUW (euw1)</option>
          <option value="eun1">EUNE (eun1)</option>
          <option value="kr">KR (kr)</option>
          <option value="jp1">JP (jp1)</option>
          <option value="br1">BR (br1)</option>
          <option value="la1">LAN (la1)</option>
          <option value="la2">LAS (la2)</option>
          <option value="oc1">OCE (oc1)</option>
          <option value="tr1">TR (tr1)</option>
          <option value="ru">RU (ru)</option>
        </select>
      </div>
      <div class="form-group">
        <label>Routing</label>
        <select id="riotRouting">
          <option value="americas">Americas</option>
          <option value="europe">Europe</option>
          <option value="asia">Asia</option>
          <option value="sea">SEA</option>
        </select>
      </div>
    </div>

    <div class="btn-row">
      <button type="submit" class="btn-primary">Save Keys</button>
      <button type="button" class="btn-secondary" onclick="window.close()">Cancel</button>
    </div>
  </form>

  <div class="status" id="status"></div>

  <div class="divider"></div>

  <div class="legal">
    <div class="legal-title">About Rift Architect</div>
    <p>Rift Architect isn't endorsed by Riot Games and doesn't reflect the views or opinions of Riot Games or anyone officially involved in producing or managing Riot Games properties. Riot Games, and all associated properties are trademarks or registered trademarks of Riot Games, Inc.</p>
  </div>

  <script>
    const $riotKey = document.getElementById("riotKey");
    const $anthropicKey = document.getElementById("anthropicKey");
    const $riotRegion = document.getElementById("riotRegion");
    const $riotRouting = document.getElementById("riotRouting");
    const $status = document.getElementById("status");

    function toggleVis(id) {
      const input = document.getElementById(id);
      const btn = input.parentElement.querySelector(".toggle-vis");
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "hide";
      } else {
        input.type = "password";
        btn.textContent = "show";
      }
    }

    function showStatus(msg, type) {
      $status.className = `status ${type}`;
      $status.textContent = msg;
      if (type === "success") {
        setTimeout(() => { $status.style.display = "none"; }, 3000);
      }
    }

    // Load current keys on open
    if (window.riftApi) {
      window.riftApi.invoke("keys:get").then((keys) => {
        if (keys) {
          $riotKey.value = keys.RIOT_API_KEY || "";
          $anthropicKey.value = keys.ANTHROPIC_API_KEY || "";
          $riotRegion.value = keys.RIOT_REGION || "na1";
          $riotRouting.value = keys.RIOT_ROUTING || "americas";
        }
      });
    }

    document.getElementById("settingsForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!window.riftApi) {
        showStatus("IPC not available", "error");
        return;
      }

      const keys = {
        RIOT_API_KEY: $riotKey.value.trim(),
        ANTHROPIC_API_KEY: $anthropicKey.value.trim(),
        RIOT_REGION: $riotRegion.value,
        RIOT_ROUTING: $riotRouting.value,
      };

      try {
        await window.riftApi.invoke("keys:save", keys);
        showStatus("Keys saved successfully. Changes take effect immediately.", "success");
      } catch (err) {
        showStatus("Failed to save keys: " + err.message, "error");
      }
    });
  </script>
</body>
</html>
